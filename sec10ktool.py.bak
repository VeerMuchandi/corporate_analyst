"""Tool that downloads 10k report for a corporation."""


from typing import Optional


def get_10k_report_link(ticker: str) -> tuple[Optional[str], Optional[str]]:
    """Downloads a 10-K report from the SEC API.

    Args:
        ticker: The company's ticker symbol

    Returns:
        The URL for the 10-K report or None if there's an error.
        Prints error information if the API call is not successful.
    """
    #make an api call to cloud run at https://sec-10-kreport-tool-121968733869.us-central1.run.app/get_10k_link?ticker=TSLA
    import requests
    import os
    try:
        api_url = os.environ.get("SEC_10K_API_URL")
        response = requests.get(f"{api_url}/get_10k_link?ticker={ticker}")
        response.raise_for_status()
        data = response.json()
        return data.get("url"), data.get("date_of_report")
    except requests.exceptions.RequestException as e:
        print(f"Error during API call: {e}")
        return None, None
    except (KeyError, ValueError) as e:
        print(f"Error processing API response: {e}")
        return None, None
        

     

def download_sec_filing(url: str, ticker: str) -> Optional[str]:
    """Downloads a SEC filing from the provided URL.

    Args:
        url: The URL of the SEC filing.
        ticker: The company's ticker symbol.

    Returns:
        The extracted text from the downloaded SEC filing and converted to text,
        or None if there's an error.
    """

    #call https://sec-10-kreport-tool-121968733869.us-central1.run.app/download_10k?ticker=GOOG&url=https://www.sec.gov/Archives/edgar/data/1652044/000165204425000014/goog-20241231.htm
    import requests
    import os
    try:
        api_url = os.environ.get("SEC_10K_API_URL")
        response = requests.get(f"{api_url}/download_10k?ticker={ticker}&url={url}")
        response.raise_for_status()
        data = response.json()
        return data.get("text_report")
    except requests.exceptions.RequestException as e:
        print(f"Error during API call: {e}")
        return None
    except (KeyError, ValueError) as e:
        print(f"Error processing API response: {e}")
        return None
        